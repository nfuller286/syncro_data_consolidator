# SDC V2.0 Data Model Definitions

This document provides a detailed, human-readable definition of the data models used in the Syncro Data Consolidator (SDC) Version 2.0.

The V2.0 architecture moves away from a single, monolithic `CUIS` structure to a more flexible, two-tiered system:

1.  **The `Session` Model:** Represents the foundational "evidence" of work. It is a continuous block of activity from a single source (e.g., a SillyTavern chat, a series of ScreenConnect connections). These are the primary objects that are edited and enriched throughout the processing pipeline.
2.  **The `Work Item` Model:** Represents a logical block of labor. It is a *calculated* object, conceptually designed to merge one or more `Sessions` that occurred close together in time. (Note: The `Work Item` model is currently a future enhancement and not yet implemented.)

---

## The `Session` Model (`session_v2.py`)

This is the primary data object in SDC V2.0. It is persisted as a JSON file and is designed to be safely updated by both automated ingestors and manual user edits.

### `meta: SessionMeta`
Contains metadata for tracking and processing the session within the SDC system.

*   **`session_id`** (`string`): A unique, **non-deterministic** UUID for the session, generated upon ingestion.
*   **`schema_version`** (`string`): The version of the data model, e.g., "2.0".
*   **`source_system`** (`string`): The system the data originated from (e.g., "SillyTavern", "ScreenConnect", "SyncroRMM", "notes.json").
*   **`source_identifiers`** (`list of strings`): A list of specific identifiers from the source system that contributed to this session (e.g., source file paths like `["screenconnect_log_2025-05.csv"]` or API IDs like `["/tickets/12345"]`).
*   **`processing_status`** (`string`): The current state of the session in the workflow (e.g., "Needs Linking", "Linked", "Complete", "Reviewed", "error"). This field is preserved during updates.
*   **`processing_log`** (`list of strings`): A chronological log of processing steps (e.g., processor names like "customer_linker_v2.1", "session_llm_analyzer_title_v1.1") that have been applied to this session.
*   **`ingestion_timestamp_utc`** (`datetime`): The timestamp when this session was first created by the SDC system.
*   **`last_updated_timestamp_utc`** (`datetime`): The timestamp when this session file was last modified by the SDC system.

### `context: SessionContext`
Contains information for linking the session to business entities like customers and contacts.

*   **`customer_id`** (`integer`, optional): The authoritative Syncro customer ID, populated by the linking process.
*   **`customer_name`** (`string`, optional): The guessed name from the source, or the authoritative name after linking.
*   **`contact_id`** (`integer`, optional): The authoritative Syncro contact ID, populated by the linking process.
*   **`contact_name`** (`string`, optional): The guessed name from the source, or the authoritative name after linking.
*   **`links`** (`list of strings`): A flexible list of keywords or identifiers to associate this session with a larger context (e.g., `["Project: ClientX Firewall", "Ticket: 12345", "st_chat_id:abc123def"]`). This field is preserved during updates.

### `insights: SessionInsights`
Contains calculated or AI-generated information derived from the session's content.

*   **`session_start_time_utc`** (`datetime`): The start time of the earliest `SessionSegment` in the session.
*   **`session_end_time_utc`** (`datetime`): The end time of the latest `SessionSegment` in the session.
*   **`session_duration_minutes`** (`integer`): The total duration in minutes calculated from `session_start_time_utc` and `session_end_time_utc`.
*   **`source_title`** (`string`, optional): The title as it appeared in the original source system (e.g., a ticket subject).
*   **`llm_generated_title`** (`string`, optional): A concise title for the session automatically generated by an LLM.
*   **`llm_generated_category`** (`string`, optional): A category (e.g., "Hardware", "Software") assigned to the session by an LLM.
*   **`generated_summaries`** (`dictionary of strings`): A flexible dictionary for storing multiple types of LLM-generated summaries, keyed by a summary type (e.g., `{"default": "..."}`, `{"invoice": "..."}`).
*   **`structured_llm_results`** (`dictionary`, optional): A flexible dictionary for storing structured JSON results from more complex LLM analyses (e.g., keyword extraction, entity recognition).
*   **`user_notes`** (`string`): A dedicated field for **manual notes and summaries**. This field is critical and is always preserved during updates.

### `segments: List[SessionSegment]`
Contains the raw, granular events that were merged to create this session. Each segment represents one atomic event from the source data.

*   **`segment_id`** (`string`): A unique UUID for the individual segment.
*   **`start_time_utc`** (`datetime`): The start time of this specific event.
*   **`end_time_utc`** (`datetime`): The end time of this specific event (can be the same as start time for instantaneous events like chat messages).
*   **`type`** (`string`): The type of the segment (e.g., "ChatMessage", "RemoteConnection", "TicketComment", "TicketInitialIssue", "SMS", "Email", "PrivateNote", "PublicNote", "TicketToDo", "StandaloneToDo").
*   **`author`** (`string`, optional): The person or system that generated the event.
*   **`content`** (`string`, optional): The text content of the event (e.g., the chat message, a log entry, a note body).
*   **`metadata`** (`dictionary`, optional): A flexible dictionary for any other source-specific raw data relevant to this specific segment (e.g., `{"computer_name": "CLIENTX-DC01", "connection_id": "abc-123"}`).

---

## The `Work Item` Model (`work_item_v2.py`) - (Future Enhancement)

This is a **calculated object** that represents a single, contiguous block of labor. It is designed to be generated by the system by grouping related `Session` objects and should not be manually edited, as any changes will be overwritten when the logic is re-run.

*   **`work_item_id`** (`string`): A unique, non-deterministic UUID for this work item instance.
*   **`schema_version`** (`string`): The version of the data model, e.g., "2.0".
*   **`customer_id`** (`integer`, optional): The customer ID, typically inherited from the component sessions.
*   **`component_session_ids`** (`list of strings`): A list of the `session_id`s that were merged together to create this work item. This provides a direct link back to the "evidence".
*   **`calculated_links`** (`list of strings`): A **read-only** list of all unique `links` gathered from all component sessions. This provides a convenient, at-a-glance view of all projects associated with this block of labor.

### `calculated_insights: WorkItemCalculatedInsights`
Contains insights that are calculated by aggregating data from all component sessions.

*   **`work_item_start_time_utc`** (`datetime`): The start time of the earliest session in the group.
*   **`work_item_end_time_utc`** (`datetime`): The end time of the latest session in the group.
*   **`total_duration_minutes`** (`integer`): The total duration from the start of the first session to the end of the last session.
*   **`llm_combined_summary`** (`string`, optional): A summary of the entire work item, potentially generated by an LLM in the future.